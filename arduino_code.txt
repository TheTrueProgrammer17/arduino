#include <Servo.h>

// --- CONFIGURATION ---
#define PIN_T200_LEFT   9  
#define PIN_T200_RIGHT  10 
#define PIN_BLDC_V1     6  
#define PIN_BLDC_V2     5  

// New Servo Pins for the Arm
#define PIN_ARM_LEFT    3
#define PIN_ARM_RIGHT   11

Servo motors[4];
Servo arm_servos[2];

void setup() {
  Serial.begin(115200);

  // Attach Thrusters
  motors[0].attach(PIN_T200_LEFT, 1000, 2000);
  motors[1].attach(PIN_T200_RIGHT, 1000, 2000);
  motors[2].attach(PIN_BLDC_V1, 1000, 2000);
  motors[3].attach(PIN_BLDC_V2, 1000, 2000);

  // Attach Arm Servos
  arm_servos[0].attach(PIN_ARM_LEFT);
  arm_servos[1].attach(PIN_ARM_RIGHT);

  // ARMING SEQUENCE
  motors[0].writeMicroseconds(1500);
  motors[1].writeMicroseconds(1500);
  motors[2].writeMicroseconds(1000);
  motors[3].writeMicroseconds(1000);

  // Default Arm Position (90 degrees / Neutral)
  arm_servos[0].write(90);
  arm_servos[1].write(90);

  delay(7000);
}

void loop() {
  if (Serial.available() > 0) {
    // PARSE INCOMING DATA (Now expecting 6 values)
    int p1 = Serial.parseInt(); // T200 Left
    int p2 = Serial.parseInt(); // T200 Right
    int p3 = Serial.parseInt(); // BLDC V1
    int p4 = Serial.parseInt(); // BLDC V2
    int p5 = Serial.parseInt(); // Arm Servo Left
    int p6 = Serial.parseInt(); // Arm Servo Right

    if (Serial.read() == '\n') {
      // Constrain and write thruster values
      motors[0].writeMicroseconds(constrain(p1, 1100, 1900));
      motors[1].writeMicroseconds(constrain(p2, 1100, 1900));
      motors[2].writeMicroseconds(constrain(p3, 1000, 2000));
      motors[3].writeMicroseconds(constrain(p4, 1000, 2000));
      
      // Constrain and write arm values (0 to 180 degrees)
      arm_servos[0].write(constrain(p5, 0, 180));
      arm_servos[1].write(constrain(p6, 0, 180));
    }
  }
}